#ifndef MEMORY_MANAGEMENT_H
#define MEMORY_MANAGEMENT_H

#include "types.h"

static inline void *alloc(const uint64_t num, const uint64_t size) {

  // 64 bytes for complex double, 32 for double
  // so 64 is safe either way
  const uint64_t alignment = 64;
  const uint64_t aligned_size = ((num*size + alignment-1)
				 /alignment)*alignment;

  void *ptr = aligned_alloc(alignment, aligned_size);

  if (NULL == ptr) {
    fprintf(stderr, "Out of memory in xcalloc.\n");
    exit(1);
  }
  memset(ptr, 0, aligned_size);

  return ptr;
}

static inline void safe_memory_free(void **ptr) {
  if (NULL != ptr && NULL != *ptr) {
    free( ptr );
    *ptr = NULL;
  }
}

#define safe_free(pointer) safe_memory_free((void **) &(pointer))


#endif // MEMORY_MANAGEMENT_H
